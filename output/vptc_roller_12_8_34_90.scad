// ВПТК редуктор с роликами

$fn = 128;

// Параметры
d_roller = 8.000;
h_roller = 6.000;
hc = 3.520;
Rsep_m = 32.400;
Rsep_out = 34.160;
Rsep_in = 30.640;
D_out = 90.000;
h_reducer = 15.000;

// Высота профильного выреза (на 4 мм выше роликов)
h_cut = h_roller + 4;

// === Корпус (жёсткое колесо) ===
module rigid_gear() {
    difference() {
        // Гладкий внешний цилиндр
        cylinder(h = h_reducer, r = D_out / 2, center = false);
        
        // Профильная внутренняя поверхность (только сверху)
        translate([0, 0, h_reducer - h_cut])
            linear_extrude(height = h_cut, center = false)
                polygon(points = [
                [0.00000, 38.00000],
        [0.74478, 37.96365],
        [1.47370, 37.85732],
        [2.17330, 37.68847],
        [2.83411, 37.46765],
        [3.45097, 37.20667],
        [4.02233, 36.91704],
        [4.54918, 36.60919],
        [5.03392, 36.29219],
        [5.47950, 35.97387],
        [5.88880, 35.66103],
        [6.26433, 35.35971],
        [6.60798, 35.07535],
        [6.92095, 34.81287],
        [7.20371, 34.57663],
        [7.45601, 34.37030],
        [7.67696, 34.19663],
        [7.86524, 34.05712],
        [8.01949, 33.95157],
        [8.13896, 33.87777],
        [8.22442, 33.83132],
        [8.27918, 33.80590],
        [8.30998, 33.79413],
        [8.32708, 33.78905],
        [8.34345, 33.78561],
        [8.37298, 33.78176],
        [8.42835, 33.77849],
        [8.51945, 33.77897],
        [8.65269, 33.78725],
        [8.83125, 33.80700],
        [9.05578, 33.84075],
        [9.32535, 33.88954],
        [9.63816, 33.95288],
        [9.99216, 34.02894],
        [10.38539, 34.11474],
        [10.81616, 34.20633],
        [11.28322, 34.29894],
        [11.78564, 34.38698],
        [12.32282, 34.46408],
        [12.89416, 34.52300],
        [13.49875, 34.55558],
        [14.13470, 34.55279],
        [14.79839, 34.50500],
        [15.48358, 34.40262],
        [16.18074, 34.23729],
        [16.87702, 34.00346],
        [17.55726, 33.70000],
        [18.20596, 33.33107],
        [18.80980, 32.90579],
        [19.35961, 32.43668],
        [19.85115, 31.93750],
        [20.28473, 31.42130],
        [20.66395, 30.89935],
        [20.99434, 30.38074],
        [21.28222, 29.87262],
        [21.53386, 29.38075],
        [21.75510, 28.90990],
        [21.95107, 28.46434],
        [22.12610, 28.04801],
        [22.28367, 27.66473],
        [22.42638, 27.31818],
        [22.55584, 27.01178],
        [22.67272, 26.74849],
        [22.77667, 26.53039],
        [22.86652, 26.35823],
        [22.94059, 26.23076],
        [22.99740, 26.14416],
        [23.03666, 26.09171],
        [23.06046, 26.06411],
        [23.07410, 26.05049],
        [23.08629, 26.04017],
        [23.10811, 26.02445],
        [23.15133, 25.99778],
        [23.22651, 25.95792],
        [23.34167, 25.90518],
        [23.50179, 25.84123],
        [23.70900, 25.76804],
        [23.96324, 25.68708],
        [24.26288, 25.59892],
        [24.60536, 25.50306],
        [24.98759, 25.39792],
        [25.40628, 25.28094],
        [25.85807, 25.14862],
        [26.33960, 24.99657],
        [26.84736, 24.81955],
        [27.37756, 24.61155],
        [27.92573, 24.36586],
        [28.48625, 24.07537],
        [29.05174, 23.73315],
        [29.61259, 23.33332],
        [30.15681, 22.87241],
        [30.67062, 22.35080],
        [31.13993, 21.77372],
        [31.55247, 21.15138],
        [31.89993, 20.49766],
        [32.17919, 19.82791],
        [32.39219, 19.15658],
        [32.54481, 18.49558],
        [32.64526, 17.85366],
        [32.70262, 17.23669],
        [32.72587, 16.64836],
        [32.72338, 16.09097],
        [32.70266, 15.56612],
        [32.67036, 15.07517],
        [32.63229, 14.61961],
        [32.59343, 14.20113],
        [32.55791, 13.82175],
        [32.52893, 13.48371],
        [32.50862, 13.18934],
        [32.49785, 12.94073],
        [32.49614, 12.73925],
        [32.50162, 12.58484],
        [32.51133, 12.47525],
        [32.52187, 12.40517],
        [32.53053, 12.36591],
        [32.53657, 12.34575],
        [32.54222, 12.33127],
        [32.55283, 12.30939],
        [32.57603, 12.26925],
        [32.62016, 12.20340],
        [32.69270, 12.10790],
        [32.79918, 11.98159],
        [32.94280, 11.82504],
        [33.12449, 11.63953],
        [33.34330, 11.42638],
        [33.59692, 11.18643],
        [33.88201, 10.91984],
        [34.19454, 10.62598],
        [34.53000, 10.30345],
        [34.88341, 9.95003],
        [35.24934, 9.56282],
        [35.62174, 9.13832],
        [35.99370, 8.67269],
        [36.35714, 8.16219],
        [36.70253, 7.60388],
        [37.01886, 6.99666],
        [37.29399, 6.34245],
        [37.51575, 5.64727],
        [37.67366, 4.92168],
        [37.76089, 4.17997],
        [37.77571, 3.43824],
        [37.72170, 2.71187],
        [37.60680, 2.01331],
        [37.44150, 1.35103],
        [37.23715, 0.72950],
        [37.00465, 0.15010],
        [36.75384, -0.38788],
        [36.49339, -0.88619],
        [36.23085, -1.34690],
        [35.97285, -1.77194],
        [35.72533, -2.16280],
        [35.49359, -2.52037],
        [35.28231, -2.84489],
        [35.09549, -3.13596],
        [34.93625, -3.39259],
        [34.80655, -3.61337],
        [34.70686, -3.79683],
        [34.63580, -3.94200],
        [34.59001, -4.04922],
        [34.56424, -4.12117],
        [34.55214, -4.16372],
        [34.54745, -4.18639],
        [34.54554, -4.20173],
        [34.54458, -4.22377],
        [34.54584, -4.26594],
        [34.55300, -4.33921],
        [34.57079, -4.45109],
        [34.60372, -4.60568],
        [34.65510, -4.80429],
        [34.72662, -5.04640],
        [34.81831, -5.33052],
        [34.92870, -5.65483],
        [35.05509, -6.01759],
        [35.19376, -6.41742],
        [35.34017, -6.85340],
        [35.48900, -7.32509],
        [35.63421, -7.83249],
        [35.76896, -8.37586],
        [35.88547, -8.95545],
        [35.97503, -9.57094],
        [36.02794, -10.22079],
        [36.03397, -10.90126],
        [35.98311, -11.60557],
        [35.86700, -12.32327],
        [35.68059, -13.04057],
        [35.42367, -13.74175],
        [35.10137, -14.41145],
        [34.72347, -15.03714],
        [34.30253, -15.61071],
        [33.85183, -16.12886],
        [33.38373, -16.59236],
        [32.90883, -17.00479],
        [32.43580, -17.37118],
        [31.97169, -17.69711],
        [31.52237, -17.98798],
        [31.09292, -18.24869],
        [30.68796, -18.48342],
        [30.31179, -18.69556],
        [29.96850, -18.88764],
        [29.66186, -19.06130],
        [29.39520, -19.21725],
        [29.17106, -19.35530],
        [28.99077, -19.47445],
        [28.85389, -19.57323],
        [28.75767, -19.65030],
        [28.69666, -19.70533],
        [28.66283, -19.74014],
        [28.64638, -19.75972],
        [28.63725, -19.77250],
        [28.62692, -19.78977],
        [28.60978, -19.82401],
        [28.58349, -19.88690],
        [28.54844, -19.98777],
        [28.50659, -20.13281],
        [28.46029, -20.32515],
        [28.41140, -20.56546],
        [28.36080, -20.85261],
        [28.30824, -21.18443],
        [28.25228, -21.55819],
        [28.19045, -21.97093],
        [28.11928, -22.41971],
        [28.03440, -22.90168],
        [27.93061, -23.41403],
        [27.80184, -23.95384],
        [27.64122, -24.51780],
        [27.44123, -25.10179],
        [27.19403, -25.70019],
        [26.89214, -26.30533],
        [26.52952, -26.90695],
        [26.10302, -27.49225],
        [25.61383, -28.04679],
        [25.06827, -28.55632],
        [24.47742, -29.00906],
        [23.85548, -29.39764],
        [23.21742, -29.71995],
        [22.57687, -29.97862],
        [21.94489, -30.17969],
        [21.32959, -30.33107],
        [20.73665, -30.44125],
        [20.16994, -30.51853],
        [19.63224, -30.57053],
        [19.12583, -30.60409],
        [18.65283, -30.62518],
        [18.21547, -30.63894],
        [17.81616, -30.64963],
        [17.45746, -30.66062],
        [17.14199, -30.67424],
        [16.87217, -30.69169],
        [16.64977, -30.71292],
        [16.47535, -30.73659],
        [16.34747, -30.76035],
        [16.26194, -30.78138],
        [16.21130, -30.79737],
        [16.18499, -30.80778],
        [16.17034, -30.81495],
        [16.15443, -30.82441],
        [16.12606, -30.84433],
        [16.07719, -30.88397],
        [16.00332, -30.95197],
        [15.90294, -31.05510],
        [15.77646, -31.19762],
        [15.62518, -31.38132],
        [15.45045, -31.60591],
        [15.25314, -31.86953],
        [15.03339, -32.16923],
        [14.79051, -32.50134],
        [14.52292, -32.86169],
        [14.22823, -33.24578],
        [13.90322, -33.64875],
        [13.54399, -34.06531],
        [13.14605, -34.48945],
        [12.70467, -34.91421],
        [12.21541, -35.33123],
        [11.67492, -35.73049],
        [11.08217, -36.10032],
        [10.43967, -36.42800],
        [9.75445, -36.70108],
        [9.03811, -36.90934],
        [8.30560, -37.04674],
        [7.57296, -37.11253],
        [6.85486, -37.11109],
        [6.16271, -37.05064],
        [5.50409, -36.94151],
        [4.88298, -36.79449],
        [4.30076, -36.61989],
        [3.75718, -36.42701],
        [3.25123, -36.22406],
        [2.78171, -36.01828],
        [2.34769, -35.81608],
        [1.94866, -35.62312],
        [1.58468, -35.44442],
        [1.25638, -35.28428],
        [0.96492, -35.14611],
        [0.71185, -35.03230],
        [0.49878, -34.94384],
        [0.32694, -34.88011],
        [0.19642, -34.83864],
        [0.10522, -34.81519],
        [0.04835, -34.80438],
        [0.01723, -34.80071],
        [0.00000, -34.80000],
        [-0.01723, -34.80071],
        [-0.04835, -34.80438],
        [-0.10522, -34.81519],
        [-0.19642, -34.83864],
        [-0.32694, -34.88011],
        [-0.49878, -34.94384],
        [-0.71185, -35.03230],
        [-0.96492, -35.14611],
        [-1.25638, -35.28428],
        [-1.58468, -35.44442],
        [-1.94866, -35.62312],
        [-2.34769, -35.81608],
        [-2.78171, -36.01828],
        [-3.25123, -36.22406],
        [-3.75718, -36.42701],
        [-4.30076, -36.61989],
        [-4.88298, -36.79449],
        [-5.50409, -36.94151],
        [-6.16271, -37.05064],
        [-6.85486, -37.11109],
        [-7.57296, -37.11253],
        [-8.30560, -37.04674],
        [-9.03811, -36.90934],
        [-9.75445, -36.70108],
        [-10.43967, -36.42800],
        [-11.08217, -36.10032],
        [-11.67492, -35.73049],
        [-12.21541, -35.33123],
        [-12.70467, -34.91421],
        [-13.14605, -34.48945],
        [-13.54399, -34.06531],
        [-13.90322, -33.64875],
        [-14.22823, -33.24578],
        [-14.52292, -32.86169],
        [-14.79051, -32.50134],
        [-15.03339, -32.16923],
        [-15.25314, -31.86953],
        [-15.45045, -31.60591],
        [-15.62518, -31.38132],
        [-15.77646, -31.19762],
        [-15.90294, -31.05510],
        [-16.00332, -30.95197],
        [-16.07719, -30.88397],
        [-16.12606, -30.84433],
        [-16.15443, -30.82441],
        [-16.17034, -30.81495],
        [-16.18499, -30.80778],
        [-16.21130, -30.79737],
        [-16.26194, -30.78138],
        [-16.34747, -30.76035],
        [-16.47535, -30.73659],
        [-16.64977, -30.71292],
        [-16.87217, -30.69169],
        [-17.14199, -30.67424],
        [-17.45746, -30.66062],
        [-17.81616, -30.64963],
        [-18.21547, -30.63894],
        [-18.65283, -30.62518],
        [-19.12583, -30.60409],
        [-19.63224, -30.57053],
        [-20.16994, -30.51853],
        [-20.73665, -30.44125],
        [-21.32959, -30.33107],
        [-21.94489, -30.17969],
        [-22.57687, -29.97862],
        [-23.21742, -29.71995],
        [-23.85548, -29.39764],
        [-24.47742, -29.00906],
        [-25.06827, -28.55632],
        [-25.61383, -28.04679],
        [-26.10302, -27.49225],
        [-26.52952, -26.90695],
        [-26.89214, -26.30533],
        [-27.19403, -25.70019],
        [-27.44123, -25.10179],
        [-27.64122, -24.51780],
        [-27.80184, -23.95384],
        [-27.93061, -23.41403],
        [-28.03440, -22.90168],
        [-28.11928, -22.41971],
        [-28.19045, -21.97093],
        [-28.25228, -21.55819],
        [-28.30824, -21.18443],
        [-28.36080, -20.85261],
        [-28.41140, -20.56546],
        [-28.46029, -20.32515],
        [-28.50659, -20.13281],
        [-28.54844, -19.98777],
        [-28.58349, -19.88690],
        [-28.60978, -19.82401],
        [-28.62692, -19.78977],
        [-28.63725, -19.77250],
        [-28.64638, -19.75972],
        [-28.66283, -19.74014],
        [-28.69666, -19.70533],
        [-28.75767, -19.65030],
        [-28.85389, -19.57323],
        [-28.99077, -19.47445],
        [-29.17106, -19.35530],
        [-29.39520, -19.21725],
        [-29.66186, -19.06130],
        [-29.96850, -18.88764],
        [-30.31179, -18.69556],
        [-30.68796, -18.48342],
        [-31.09292, -18.24869],
        [-31.52237, -17.98798],
        [-31.97169, -17.69711],
        [-32.43580, -17.37118],
        [-32.90883, -17.00479],
        [-33.38373, -16.59236],
        [-33.85183, -16.12886],
        [-34.30253, -15.61071],
        [-34.72347, -15.03714],
        [-35.10137, -14.41145],
        [-35.42367, -13.74175],
        [-35.68059, -13.04057],
        [-35.86700, -12.32327],
        [-35.98311, -11.60557],
        [-36.03397, -10.90126],
        [-36.02794, -10.22079],
        [-35.97503, -9.57094],
        [-35.88547, -8.95545],
        [-35.76896, -8.37586],
        [-35.63421, -7.83249],
        [-35.48900, -7.32509],
        [-35.34017, -6.85340],
        [-35.19376, -6.41742],
        [-35.05509, -6.01759],
        [-34.92870, -5.65483],
        [-34.81831, -5.33052],
        [-34.72662, -5.04640],
        [-34.65510, -4.80429],
        [-34.60372, -4.60568],
        [-34.57079, -4.45109],
        [-34.55300, -4.33921],
        [-34.54584, -4.26594],
        [-34.54458, -4.22377],
        [-34.54554, -4.20173],
        [-34.54745, -4.18639],
        [-34.55214, -4.16372],
        [-34.56424, -4.12117],
        [-34.59001, -4.04922],
        [-34.63580, -3.94200],
        [-34.70686, -3.79683],
        [-34.80655, -3.61337],
        [-34.93625, -3.39259],
        [-35.09549, -3.13596],
        [-35.28231, -2.84489],
        [-35.49359, -2.52037],
        [-35.72533, -2.16280],
        [-35.97285, -1.77194],
        [-36.23085, -1.34690],
        [-36.49339, -0.88619],
        [-36.75384, -0.38788],
        [-37.00465, 0.15010],
        [-37.23715, 0.72950],
        [-37.44150, 1.35103],
        [-37.60680, 2.01331],
        [-37.72170, 2.71187],
        [-37.77571, 3.43824],
        [-37.76089, 4.17997],
        [-37.67366, 4.92168],
        [-37.51575, 5.64727],
        [-37.29399, 6.34245],
        [-37.01886, 6.99666],
        [-36.70253, 7.60388],
        [-36.35714, 8.16219],
        [-35.99370, 8.67269],
        [-35.62174, 9.13832],
        [-35.24934, 9.56282],
        [-34.88341, 9.95003],
        [-34.53000, 10.30345],
        [-34.19454, 10.62598],
        [-33.88201, 10.91984],
        [-33.59692, 11.18643],
        [-33.34330, 11.42638],
        [-33.12449, 11.63953],
        [-32.94280, 11.82504],
        [-32.79918, 11.98159],
        [-32.69270, 12.10790],
        [-32.62016, 12.20340],
        [-32.57603, 12.26925],
        [-32.55283, 12.30939],
        [-32.54222, 12.33127],
        [-32.53657, 12.34575],
        [-32.53053, 12.36591],
        [-32.52187, 12.40517],
        [-32.51133, 12.47525],
        [-32.50162, 12.58484],
        [-32.49614, 12.73925],
        [-32.49785, 12.94073],
        [-32.50862, 13.18934],
        [-32.52893, 13.48371],
        [-32.55791, 13.82175],
        [-32.59343, 14.20113],
        [-32.63229, 14.61961],
        [-32.67036, 15.07517],
        [-32.70266, 15.56612],
        [-32.72338, 16.09097],
        [-32.72587, 16.64836],
        [-32.70262, 17.23669],
        [-32.64526, 17.85366],
        [-32.54481, 18.49558],
        [-32.39219, 19.15658],
        [-32.17919, 19.82791],
        [-31.89993, 20.49766],
        [-31.55247, 21.15138],
        [-31.13993, 21.77372],
        [-30.67062, 22.35080],
        [-30.15681, 22.87241],
        [-29.61259, 23.33332],
        [-29.05174, 23.73315],
        [-28.48625, 24.07537],
        [-27.92573, 24.36586],
        [-27.37756, 24.61155],
        [-26.84736, 24.81955],
        [-26.33960, 24.99657],
        [-25.85807, 25.14862],
        [-25.40628, 25.28094],
        [-24.98759, 25.39792],
        [-24.60536, 25.50306],
        [-24.26288, 25.59892],
        [-23.96324, 25.68708],
        [-23.70900, 25.76804],
        [-23.50179, 25.84123],
        [-23.34167, 25.90518],
        [-23.22651, 25.95792],
        [-23.15133, 25.99778],
        [-23.10811, 26.02445],
        [-23.08629, 26.04017],
        [-23.07410, 26.05049],
        [-23.06046, 26.06411],
        [-23.03666, 26.09171],
        [-22.99740, 26.14416],
        [-22.94059, 26.23076],
        [-22.86652, 26.35823],
        [-22.77667, 26.53039],
        [-22.67272, 26.74849],
        [-22.55584, 27.01178],
        [-22.42638, 27.31818],
        [-22.28367, 27.66473],
        [-22.12610, 28.04801],
        [-21.95107, 28.46434],
        [-21.75510, 28.90990],
        [-21.53386, 29.38075],
        [-21.28222, 29.87262],
        [-20.99434, 30.38074],
        [-20.66395, 30.89935],
        [-20.28473, 31.42130],
        [-19.85115, 31.93750],
        [-19.35961, 32.43668],
        [-18.80980, 32.90579],
        [-18.20596, 33.33107],
        [-17.55726, 33.70000],
        [-16.87702, 34.00346],
        [-16.18074, 34.23729],
        [-15.48358, 34.40262],
        [-14.79839, 34.50500],
        [-14.13470, 34.55279],
        [-13.49875, 34.55558],
        [-12.89416, 34.52300],
        [-12.32282, 34.46408],
        [-11.78564, 34.38698],
        [-11.28322, 34.29894],
        [-10.81616, 34.20633],
        [-10.38539, 34.11474],
        [-9.99216, 34.02894],
        [-9.63816, 33.95288],
        [-9.32535, 33.88954],
        [-9.05578, 33.84075],
        [-8.83125, 33.80700],
        [-8.65269, 33.78725],
        [-8.51945, 33.77897],
        [-8.42835, 33.77849],
        [-8.37298, 33.78176],
        [-8.34345, 33.78561],
        [-8.32708, 33.78905],
        [-8.30998, 33.79413],
        [-8.27918, 33.80590],
        [-8.22442, 33.83132],
        [-8.13896, 33.87777],
        [-8.01949, 33.95157],
        [-7.86524, 34.05712],
        [-7.67696, 34.19663],
        [-7.45601, 34.37030],
        [-7.20371, 34.57663],
        [-6.92095, 34.81287],
        [-6.60798, 35.07535],
        [-6.26433, 35.35971],
        [-5.88880, 35.66103],
        [-5.47950, 35.97387],
        [-5.03392, 36.29219],
        [-4.54918, 36.60919],
        [-4.02233, 36.91704],
        [-3.45097, 37.20667],
        [-2.83411, 37.46765],
        [-2.17330, 37.68847],
        [-1.47370, 37.85732],
        [-0.74478, 37.96365]
            ]);
        
        // === Группа A: основные крепёжные отверстия ===
        for (i = [0 : 7]) {
            x_hole = [-37.29995, -13.51108, 18.19240, 39.23902, 37.29995, 13.51108, -18.19240, -39.23902][i];
            y_hole = [-18.19240, -39.23902, -37.29995, -13.51108, 18.19240, 39.23902, 37.29995, 13.51108][i];
            translate([x_hole, y_hole, 0])
                cylinder(h = h_reducer, r = 1.6, center = false);
            translate([x_hole, y_hole, 0])
                cylinder(h = 3.0, r = 3.0, center = false);
        }
        
        // === Группа B: отверстия под кожух мотора ===
        for (i = [0 : 3]) {
            x_hole = [-31.69780, 27.55448, 31.69780, -27.55448][i];
            y_hole = [-27.55448, -31.69780, 27.55448, 31.69780][i];
            translate([x_hole, y_hole, 0])
                cylinder(h = 8.0, r = 1.6, center = false);
            translate([x_hole, y_hole, 5.0])
                cube(size = [6.0, 6.0, 3.0], center = true);
        }
        
        // === Группа C/D: подшипник ===
        cylinder(h = h_reducer, r = 25/2, center = false);
        translate([0, 0, 0.5])
            cylinder(h = h_reducer - 0.5, r = 26/2, center = false);
    }
}

// === Сепаратор ===
separator_h = h_roller + 4; // Высота сепаратора
slot_clearance = 0.1;       // Зазор по бокам паза
slot_w = d_roller + 2 * slot_clearance;  // Ширина паза
slot_h = h_roller + 2 * slot_clearance;  // Высота паза

module separator() {
    difference() {
        // Основное кольцо
        cylinder(h = separator_h, r = Rsep_out, center = true);
        cylinder(h = separator_h + 1, r = Rsep_in, center = true);

        // Вычитаем пазы под ролики
        for (angle = [0 : 360/12 : 359]) {
            rotate([0, 0, angle])
                translate([Rsep_m, 0, 0])
                    rotate([0, 90, 0])
                        cube([slot_h, slot_w, separator_h], center = true);
        }
    }
}

// === Ролики ===
module rollers() {
    for (i = [0 : 11]) {
        angle = i * 360 / 12;
        rotate([0, 0, angle])
            translate([Rsep_m, 0, 0])
                cylinder(r = d_roller/2, h = h_roller, center = true);
    }
}

// === Эксцентрик ===
module eccentric() {
    translate([0, 1.600, 0])
        cylinder(r = 28.400, h = hc, center = true);
}

// === Сборка ===
rigid_gear();
translate([0, 0, 10]) separator();
translate([0, 0, 10]) rollers();
translate([0, 0, 10]) eccentric();
